<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dark Chatbot UI</title>
    <style>
      /* General Layout */
      body {
        margin: 0;
        height: 100vh;
        display: flex;
        flex-direction: column;
        font-family: "Inter", sans-serif;
        background-color: #0d0d0f;
        color: #e0e0e0;
        overflow: hidden;
      }

      /* Header */
      .chatbot-header {
        background: linear-gradient(90deg, #1a1a1d, #202026);
        color: #f3f3f3;
        padding: 15px;
        font-size: 1.2rem;
        font-weight: 600;
        text-align: center;
        border-bottom: 1px solid #2b2b2f;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
      }

      /* Messages Section */
      .chatbot-messages {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 12px;
        scroll-behavior: smooth;
        margin-inline: 10rem;
      }

      /* Message Bubble */
      .chat-message {
        max-width: 75%;
        padding: 12px 16px;
        border-radius: 15px;
        font-size: 0.95rem;
        line-height: 1.4;
        word-wrap: break-word;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        opacity: 0;
        transform: translateY(10px);
        animation: fadeIn 0.3s ease forwards;
      }

      .user-msg {
        align-self: flex-end;
        background: linear-gradient(135deg, #3d3df5, #6f6fff);
        color: #fff;
        border-bottom-right-radius: 0;
      }

      .bot-msg {
        align-self: flex-start;
        background-color: #1f1f23;
        color: #ddd;
        border-bottom-left-radius: 0;
      }

      /* Input Section */
      .chatbot-input {
        display: flex;
        padding: 12px;
        background-color: #1a1a1d;
        border-top: 1px solid #2b2b2f;
        gap: 10px;
        margin-inline: 10rem;
        margin-block: 3rem;
        border-radius: 10px;
      }

      .chatbot-input input {
        flex: 1;
        background-color: #0f0f11;
        color: #e0e0e0;
        border: none;
        outline: none;
        border-radius: 10px;
        padding: 10px 14px;
        font-size: 0.95rem;
        transition: all 0.2s ease;
      }

      .chatbot-input input:focus {
        box-shadow: 0 0 0 2px #3d3df5;
      }

      .chatbot-input button {
        background-color: #3d3df5;
        color: white;
        border: none;
        border-radius: 10px;
        padding: 10px 18px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: all 0.2s ease;
      }

      .chatbot-input button:hover {
        background-color: #5c5cff;
        box-shadow: 0 0 8px rgba(93, 93, 255, 0.7);
        transform: translateY(-1px);
      }

      /* Scrollbar Styling */
      .chatbot-messages::-webkit-scrollbar {
        width: 8px;
      }

      .chatbot-messages::-webkit-scrollbar-thumb {
        background-color: #333;
        border-radius: 10px;
      }

      /* Markdown-like Styling */
      .chat-message code {
        background-color: #2b2b2f;
        padding: 2px 5px;
        border-radius: 4px;
        font-family: monospace;
        color: #a0a0ff;
      }

      .chat-message pre {
        background-color: #2b2b2f;
        padding: 10px;
        border-radius: 8px;
        overflow-x: auto;
      }

      .chat-message blockquote {
        border-left: 3px solid #555;
        padding-left: 10px;
        color: #aaa;
        margin: 5px 0;
      }

      /* Animations */
      @keyframes fadeIn {
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .typing-text {
        display: inline-flex;
        align-items: center;
        font-style: italic;
      }

      .dot {
        animation: blink 1.5s infinite;
      }

      .dot:nth-child(2) {
        animation-delay: 0.3s;
      }

      .dot:nth-child(3) {
        animation-delay: 0.6s;
      }

      @keyframes blink {
        0%,
        20% {
          opacity: 0;
        }
        50% {
          opacity: 1;
        }
        100% {
          opacity: 0;
        }
      }
    </style>
  </head>
  <body>
    <div class="chatbot-header">Â Law Bot</div>

    <div class="chatbot-messages" id="chatMessages">
      <div class="bot-msg chat-message">
        ðŸ‘‹ Hello there! Ask me anything from the
        <strong>Bombay Highcourt Judgements</strong> dataset.
      </div>
    </div>

    <div class="chatbot-input">
      <input type="text" id="userInput" placeholder="Type a message..." />
      <button id="sendBtn">Send</button>
    </div>

    <script>
      const url = "http://127.0.0.1:8000/chat";
      const sendBtn = document.getElementById("sendBtn");
      const userInput = document.getElementById("userInput");
      const chatMessages = document.getElementById("chatMessages");

      function addMessage(content, role = "user") {
        const msg = document.createElement("div");
        msg.classList.add(
          "chat-message",
          role === "user" ? "user-msg" : "bot-msg"
        );
        msg.innerHTML = content;
        chatMessages.appendChild(msg);
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }

      function typeWriterEffect(element, text, speed = 15) {
        // Clean and convert markdown to HTML
        let formattedText = text
          // Horizontal line
          .replace(/\*\*\*/g, "<hr>")
          // Heading level 3
          .replace(/###\s?(.*)/g, "<h3>$1</h3>")
          // Bold text
          .replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>")
          // Bullet points
          .replace(/(?:^|\n)\*\s?(.*)/g, "<br>â€¢ $1")
          // New lines
          .replace(/\\n/g, "<br>")
          .replace(/\n/g, "<br>");

        // Split into tokens while keeping tags intact
        const parts = formattedText.match(/(<[^>]+>|[^<]+)/g);
        let index = 0;

        function type() {
          if (index < parts.length) {
            element.innerHTML += parts[index];
            index++;
            setTimeout(type, speed);
          }
        }
        type();
      }

      async function botReply(userText) {
        try {
          // Create typing indicator with animated dots
          const typing = document.createElement("div");
          typing.classList.add("chat-message", "bot-msg");
          typing.innerHTML =
            '<span class="typing-text">Typing<span class="dot">.</span><span class="dot">.</span><span class="dot">.</span></span>';
          chatMessages.appendChild(typing);
          chatMessages.scrollTop = chatMessages.scrollHeight;

          // Send request to backend
          const response = await fetch(url, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              message: userText,
              dataset_name: "Bombay Highcourt Judgements",
            }),
          });

          const data = await response.json();

          // Remove typing indicator
          typing.remove();

          if (data.answer) {
            const msg = document.createElement("div");
            msg.classList.add("chat-message", "bot-msg");
            chatMessages.appendChild(msg);
            typeWriterEffect(msg, data.answer, 10);
            chatMessages.scrollTop = chatMessages.scrollHeight;
          } else if (data.error) {
            addMessage(`âš ï¸ Error: ${data.error}`, "bot");
          } else {
            addMessage("ðŸ¤– No valid response received.", "bot");
          }
        } catch (err) {
          addMessage(`âš ï¸ Server error: ${err.message}`, "bot");
        }
      }

      sendBtn.addEventListener("click", () => {
        const text = userInput.value.trim();
        if (!text) return;
        addMessage(text, "user");
        userInput.value = "";
        botReply(text);
      });

      userInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") sendBtn.click();
      });
    </script>
  </body>
</html>
